<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IT Admin Panel</title>
  <style>
    :root{--p:#1a5fb4;--s:#2ecc71;--d:#e74c3c;}
    *{margin:0;padding:0;box-sizing:border-box;font-family:Segoe UI,Tahoma,sans-serif;}
    body{background:#f4f6f9;color:#333;}
    .container{max-width:1000px;margin:0 auto;padding:20px;}
    header{text-align:center;margin:30px 0;}
    .logo{width:80px;height:80px;background:var(--p);color:white;border-radius:50%;margin:0 auto 15px;display:flex;align-items:center;justify-content:center;font-size:36px;font-weight:bold;}
    h1{color:var(--p);}
    .card{background:white;border-radius:12px;box-shadow:0 5px 15px rgba(0,0,0,0.1);margin:20px 0;overflow:hidden;}
    .card-header{background:var(--p);color:white;padding:15px;text-align:center;}
    .card-body{padding:25px;}
    .login-box{max-width:400px;margin:50px auto;background:white;padding:30px;border-radius:12px;box-shadow:0 5px 20px rgba(0,0,0,0.1);}
    input{width:100%;padding:12px;margin:10px 0;border:1px solid #ddd;border-radius:8px;font-size:1rem;}
    .btn{padding:12px 20px;border:none;border-radius:8px;cursor:pointer;font-weight:600;margin:5px;text-decoration:none;display:inline-block;}
    .btn-p{background:var(--p);color:white;}
    .btn-d{background:var(--d);color:white;}
    .btn:hover{opacity:0.9;}
    .report-item{padding:15px;border-bottom:1px solid #eee;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;}
    .report-name{font-weight:600;}
    .report-meta{font-size:0.85rem;color:#777;}
    .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);justify-content:center;align-items:center;z-index:1000;}
    .modal-content{background:white;padding:20px;border-radius:12px;max-width:800px;width:90%;max-height:80vh;overflow:auto;}
    .close{float:right;font-size:24px;cursor:pointer;}
    .footer{text-align:center;padding:30px;color:#777;font-size:0.9rem;}
    .hidden{display:none;}
  </style>
</head>
<body>

<!-- === Login Section === -->
<div id="loginSection" class="login-box">
  <h2 style="text-align:center;color:var(--p);">IT Admin Login</h2>
  <input type="text" id="username" placeholder="Username" value="meto">
  <input type="password" id="password" placeholder="Password" value="511970">
  <button class="btn btn-p" style="width:100%;" onclick="login()">Login</button>
  <p id="error" style="color:var(--d);text-align:center;margin-top:10px;"></p>
</div>

<!-- === Admin Panel (Hidden at Start) === -->
<div id="adminPanel" class="container hidden">
  <header>
    <div class="logo">IT</div>
    <h1>IT Admin Panel - Security Reports</h1>
  </header>

  <div class="card">
    <div class="card-header">
      Uploaded Reports
      <button class="btn btn-d" style="float:right;font-size:0.9rem;" onclick="logout()">Logout</button>
    </div>
    <div class="card-body">
      <div id="reportsList">Loading reports...</div>
    </div>
  </div>

  <div class="footer">
    © 2025 IT Security • Internal Use Only
  </div>
</div>

<!-- === Modal for Report View === -->
<div id="modal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">×</span>
    <h3 id="modalTitle"></h3>
    <pre id="modalContent" style="text-align:left;white-space:pre-wrap;font-family:monospace;"></pre>
    <div style="text-align:center;margin-top:20px;">
      <button class="btn btn-s" onclick="downloadReport()">Download as .txt</button>
    </div>
  </div>
</div>

<script>
const USERNAME = "meto";
const PASSWORD = "511970";

let reports = [];

// === Login Function ===
function login() {
  const user = document.getElementById('username').value.trim();
  const pass = document.getElementById('password').value;
  const error = document.getElementById('error');

  if (user === USERNAME && pass === PASSWORD) {
    document.getElementById('loginSection').classList.add('hidden');
    document.getElementById('adminPanel').classList.remove('hidden');
    loadReports();
  } else {
    error.textContent = "Invalid username or password!";
  }
}

// === Logout Function (No Session - Refresh = Logout) ===
function logout() {
  document.getElementById('adminPanel').classList.add('hidden');
  document.getElementById('loginSection').classList.remove('hidden');
  document.getElementById('username').value = "meto";
  document.getElementById('password').value = "511970";
  document.getElementById('error').textContent = "";
}

// === Load Reports ===
function loadReports() {
  reports = JSON.parse(localStorage.getItem('security_reports') || '[]');
  const container = document.getElementById('reportsList');
  if (reports.length === 0) {
    container.innerHTML = '<p style="text-align:center;color:#777;">No reports uploaded yet</p>';
    return;
  }
  container.innerHTML = reports.map((r, i) => `
    <div class="report-item">
      <div>
        <div class="report-name">Report #${reports.length - i}</div>
        <div class="report-meta">${new Date(r.timestamp).toLocaleString()}</div>
      </div>
      <div>
        <button class="btn btn-p" onclick="viewReport('${r.id}')">View</button>
        <button class="btn btn-d" onclick="deleteReport('${r.id}')">Delete</button>
      </div>
    </div>
  `).join('');
}

// === View Report ===
function viewReport(id) {
  const report = reports.find(r => r.id === id);
  if (!report) return;
  document.getElementById('modalTitle').textContent = `Report #${reports.indexOf(report) + 1}`;
  document.getElementById('modalContent').textContent = report.content;
  document.getElementById('modal').style.display = 'flex';
  window.currentReport = report;
}

// === Download Report ===
function downloadReport() {
  const blob = new Blob([window.currentReport.content], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `report_${new Date(window.currentReport.timestamp).toISOString().slice(0,19).replace(/:/g,'-')}.txt`;
  a.click();
}

// === Delete Report ===
function deleteReport(id) {
  if (confirm('Delete this report permanently?')) {
    reports = reports.filter(r => r.id !== id);
    localStorage.setItem('security_reports', JSON.stringify(reports));
    loadReports();
  }
}

// === Close Modal ===
function closeModal() {
  document.getElementById('modal').style.display = 'none';
}

// === Auto-refresh reports every 5 seconds ===
setInterval(() => {
  if (!document.getElementById('adminPanel').classList.contains('hidden')) {
    loadReports();
  }
}, 5000);

// === Listen for new reports ===
if (window.BroadcastChannel) {
  const channel = new BroadcastChannel('report_channel');
  channel.onmessage = () => {
    if (!document.getElementById('adminPanel').classList.contains('hidden')) {
      loadReports();
    }
  };
}

// === On Page Load: Show Login Only ===
window.onload = () => {
  document.getElementById('adminPanel').classList.add('hidden');
  document.getElementById('loginSection').classList.remove('hidden');
};
</script>
</body>
</html>
