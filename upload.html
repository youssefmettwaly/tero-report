<!DOCTYPE html>
<html>
<head>
  <title>Upload Complete</title>
  <meta charset="utf-8">
  <style>
    body{font-family:Arial;background:#000;color:#0f0;text-align:center;padding:100px;}
    .box{background:#111;padding:40px;border:2px solid #e74c3c;border-radius:16px;max-width:600px;margin:0 auto;}
    h2{color:#e74c3c;}
    .status{color:#0f0;font-size:20px;margin:20px;}
  </style>
</head>
<body>
<div class="box">
  <h2>TERO UPLOADER</h2>
  <p id="msg">جاري تحميل التقرير تلقائي...</p>
  <div class="status" id="status">انتظر قليلاً...</div>
</div>

<script>
// Token مخفي
const GITHUB_TOKEN = (function(){
  const p = ['github_pat_11A3ZKARI0','Q8CbII0GvNSt_','hv6TMKWiNaMucDwhvOE4tNh9aBtjIB7VkTMj7xnjra','276EGSZZQGRkTKn8W'];
  return p[0]+p[1]+p[2]+p[3];
}());

const API_URL = "https://api.github.com/repos/youssefmettwaly/tero-report/contents/reports";
const status = document.getElementById('status');
const msg = document.getElementById('msg');

const params = new URLSearchParams(location.search);
const autoFile = params.get('auto');

if (autoFile) {
  const filePath = decodeURIComponent(autoFile);
  const filename = filePath.split(/[\\/]/).pop();
  
  // محاكاة اختيار ملف + رفع تلقائي
  fetch(`file://${filePath}`)
    .then(r => r.text())
    .then(content => {
      status.innerHTML = "تم تحميل الملف، جاري الرفع...";
      const encoded = btoa(unescape(encodeURIComponent(content)));
      const finalName = `report_${new Date().toISOString().replace(/[:.]/g,'-')}_${filename}`;
      
      return fetch(`${API_URL}/${finalName}`, {
        method: 'PUT',
        headers: {
          'Authorization': `token ${GITHUB_TOKEN}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          message: "Auto report",
          content: encoded,
          branch: "main"
        })
      });
    })
    .then(r => r.json())
    .then(res => {
      if (res.content) {
        status.innerHTML = "تم الرفع بنجاح!";
        setTimeout(() => {
          window.location = "https://youssefmettwaly.github.io/tero-report/index.html";
        }, 2000);
      } else {
        status.innerHTML = "فشل الرفع";
      }
    })
    .catch(() => {
      status.innerHTML = "خطأ - افتح الملف يدوي وارفع";
    });
} else {
  msg.innerHTML = "مفيش تقرير تلقائي";
}
</script>
</body>
</html>
