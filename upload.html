<!DOCTYPE html>
<html>
<head>
  <title>Upload Complete</title>
  <meta charset="utf-8">
  <style>
    body{font-family:Arial;background:#000;color:#0f0;text-align:center;padding:80px;}
    .box{background:#111;padding:40px;border:2px solid #e74c3c;border-radius:16px;max-width:500px;margin:0 auto;}
    h2{color:#e74c3c;margin-bottom:20px;}
    a{color:#0f0;text-decoration:underline;}
    .log{background:#000;color:#0f0;padding:10px;margin:10px 0;font-size:11px;text-align:left;max-height:200px;overflow-y:auto;border:1px solid #e74c3c;}
  </style>
</head>
<body>
<div class="box">
  <h2 id="head">Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ±...</h2>
  <p id="status">...</p>
  <div class="log" id="log"></div>
  <p><a href="https://youssefmettwaly.github.io/tero-report/admin.html">Go to Admin Panel</a></p>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
<script>
// Ø§Ù„ØªÙˆÙƒÙ†
  const parts = [
    "github_pat_11A3ZKARI0",
    "Q8CbII0GvNSt_",
    "hv6TMKWiNaMucDwhvOE4tNh9aBtjIB7VkTMj7xnjra",
    "276EGSZZQGRkTKn8W"
  const REPO_OWNER = "youssefmettwaly";
const REPO_NAME = "tero-report";

// ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„Ø©
let chunks = {};
let totalChunks = 0;
let receivedChunks = 0;

function log(msg) {
  console.log(msg);
  const logDiv = document.getElementById('log');
  logDiv.innerHTML += msg + '<br>';
  logDiv.scrollTop = logDiv.scrollHeight;
}

function uploadToGitHub(content) {
  log("ğŸ“¤ Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¹Ù„Ù‰ GitHub...");
  
  const filename = `report_${new Date().toISOString().replace(/[:.]/g,'-').slice(0,19)}_${Math.random().toString(36).substr(2,9)}.txt`;
  const apiUrl = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${filename}`;
  
  log(`ğŸ“ Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù: ${filename}`);
  
  // ØªØ±Ù…ÙŠØ² Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¨Ù€ base64
  const encodedContent = btoa(unescape(encodeURIComponent(content)));
  
  fetch(apiUrl, {
    method: 'PUT',
    headers: {
      'Authorization': `token ${TOKEN}`,
      'Content-Type': 'application/json',
      'Accept': 'application/vnd.github.v3+json'
    },
    body: JSON.stringify({
      message: `New TERO Report - ${filename}`,
      content: encodedContent,
      branch: 'main'
    })
  })
  .then(r => {
    log(`âš¡ Ø±Ø¯ GitHub: ${r.status}`);
    if (r.ok) {
      log("âœ“ ØªÙ… Ø§Ù„Ø±ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­!");
      reportDone();
    } else {
      return r.text().then(t => {
        log("âŒ Ø®Ø·Ø£: " + t);
        reportFail();
      });
    }
  })
  .catch(err => {
    log("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: " + err.message);
    reportFail();
  });
}

function decompressData(compressedData) {
  try {
    log("ğŸ”“ Ø¬Ø§Ø±ÙŠ ÙÙƒ Ø§Ù„Ø¶ØºØ·...");
    
    // ÙÙƒ base64
    const binaryString = atob(compressedData);
    const bytes = new Uint8Array(binaryString.length);
    for (let i = 0; i < binaryString.length; i++) {
      bytes[i] = binaryString.charCodeAt(i);
    }
    
    // ÙÙƒ zlib
    const decompressed = pako.inflate(bytes, { to: 'string' });
    log("âœ“ ØªÙ… ÙÙƒ Ø§Ù„Ø¶ØºØ· Ø¨Ù†Ø¬Ø§Ø­");
    return decompressed;
  } catch (e) {
    log("âŒ Ø®Ø·Ø£ ÙÙŠ ÙÙƒ Ø§Ù„Ø¶ØºØ·: " + e.message);
    return null;
  }
}

function processChunks() {
  log("ğŸ”— Ø¬Ù…Ø¹ Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡...");
  
  // ØªØ¬Ù…ÙŠØ¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨
  let allData = '';
  for (let i = 1; i <= totalChunks; i++) {
    if (!chunks[i]) {
      log(`âŒ Ø§Ù„Ø¬Ø²Ø¡ ${i} Ù…ÙÙ‚ÙˆØ¯!`);
      reportFail();
      return;
    }
    allData += chunks[i];
  }
  
  log(`âœ“ ØªÙ… Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ ${totalChunks} Ø£Ø¬Ø²Ø§Ø¡ (${allData.length} Ø­Ø±Ù)`);
  
  // ÙÙƒ Ø§Ù„Ø¶ØºØ·
  const decompressed = decompressData(allData);
  if (!decompressed) {
    reportFail();
    return;
  }
  
  log(`ğŸ“Š Ø­Ø¬Ù… Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${decompressed.length} Ø­Ø±Ù`);
  
  // Ø±ÙØ¹ Ø¹Ù„Ù‰ GitHub
  uploadToGitHub(decompressed);
}

function reportDone() {
  document.getElementById('head').textContent = "âœ“ Upload Complete!";
  document.getElementById('status').textContent = "ØªÙ… Ø±ÙØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­ Ø¥Ù„Ù‰ GitHub";
}

function reportFail() {
  document.getElementById('head').textContent = "âŒ Upload Failed!";
  document.getElementById('status').textContent = "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø±ÙØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ±";
}

window.onload = () => {
  log("ğŸ” Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...");
  
  try {
    const params = new URLSearchParams(location.search);
    const total = params.get('total');
    const part = params.get('part');
    const data = params.get('data');
    
    if (!data) {
      log("âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·!");
      reportFail();
      return;
    }
    
    log(`ğŸ“¦ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª: ${data.length} Ø­Ø±Ù`);
    
    // Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø£ÙˆÙ„ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„ÙƒÙ„ÙŠ
    if (total) {
      totalChunks = parseInt(total);
      chunks[1] = data;
      receivedChunks = 1;
      log(`ğŸ“¥ Ø¬Ø²Ø¡ 1/${totalChunks} ØªÙ… Ø§Ø³ØªÙ‚Ø¨Ø§Ù„Ù‡ (${data.length} Ø­Ø±Ù)`);
      
      if (totalChunks === 1) {
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø¬Ø²Ø¡ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø·ØŒ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ø¨Ø§Ø´Ø±Ø©
        log("â³ Ø¬Ø²Ø¡ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø·ØŒ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...");
        setTimeout(processChunks, 500);
      }
    } 
    // Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡
    else if (part) {
      const partNum = parseInt(part);
      chunks[partNum] = data;
      receivedChunks++;
      log(`ğŸ“¥ Ø¬Ø²Ø¡ ${partNum}/${totalChunks} ØªÙ… Ø§Ø³ØªÙ‚Ø¨Ø§Ù„Ù‡ (${data.length} Ø­Ø±Ù)`);
      
      // ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ Ø§Ø³ØªÙ‚Ø¨Ù„Ù†Ø§ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡
      let allReceived = true;
      for (let i = 1; i <= totalChunks; i++) {
        if (!chunks[i]) {
          allReceived = false;
          break;
        }
      }
      
      if (allReceived) {
        log("âœ“ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ ÙˆØµÙ„Øª! Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ¬Ù…ÙŠØ¹...");
        setTimeout(processChunks, 1000);
      } else {
        log(`â³ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± ${totalChunks - receivedChunks} Ø¬Ø²Ø¡ Ø¢Ø®Ø±...`);
      }
    }
  } catch (e) {
    log("âŒ Ø®Ø·Ø£: " + e.message);
    reportFail();
  }
};
</script>
</body>
</html>
